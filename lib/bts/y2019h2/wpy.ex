defmodule Wpy do
  alias BTS.Utils
  alias Elixlsx.{Sheet, Workbook}

  @models [
    "JEEP_大切诺基",
    "JEEP_大指挥官",
    "JEEP_指南者",
    "JEEP_自由光",
    "阿尔法-罗密欧_Stelvio",
    "奥迪_A3",
    "奥迪_A4",
    "奥迪_A4 Allroad",
    "奥迪_A5",
    "奥迪_A6L",
    "奥迪_A7",
    "奥迪_A8L",
    "奥迪_Q2L",
    "奥迪_Q3",
    "奥迪_Q5",
    "奥迪_Q7",
    "奥迪_Q8",
    "宝骏_310",
    "宝骏_310W",
    "宝骏_360",
    "宝骏_510",
    "宝骏_530",
    "宝骏_560",
    "宝骏_730",
    "宝马_1系",
    "宝马_2系",
    "宝马_3GT",
    "宝马_3系",
    "宝马_4系",
    "宝马_5系",
    "宝马_6GT",
    "宝马_7系",
    "宝马_X1",
    "宝马_X2",
    "宝马_X3",
    "宝马_X4",
    "宝马_X5",
    "宝马_X6",
    "宝马_X7",
    "宝沃_BX5",
    "宝沃_BX7",
    "保时捷_MACAN",
    "保时捷_PANAMERA",
    "保时捷_卡宴",
    "北汽绅宝_X25",
    "北汽绅宝_X35",
    "北汽绅宝_智行",
    "北汽威旺_M50",
    "奔驰_A级",
    "奔驰_B级",
    "奔驰_CLA",
    "奔驰_CLS",
    "奔驰_C级",
    "奔驰_E级",
    "奔驰_GLA",
    "奔驰_GLB",
    "奔驰_GLC",
    "奔驰_GLE",
    "奔驰_GLS",
    "奔驰_G级",
    "奔驰_S级",
    "本田_CR-V",
    "本田_INSPIRE",
    "本田_UR-V",
    "本田_XR-V",
    "本田_艾力绅",
    "本田_奥德赛",
    "本田_缤智",
    "本田_飞度",
    "本田_冠道",
    "本田_杰德",
    "本田_凌派",
    "本田_思域",
    "本田_享域",
    "本田_雅阁",
    "比亚迪_F3",
    "比亚迪_宋",
    "比亚迪_宋MAX",
    "比亚迪_速锐",
    "比亚迪_唐",
    "比亚迪_元",
    "标致_301",
    "标致_4008",
    "标致_408",
    "标致_5008",
    "标致_508",
    "别克_GL6",
    "别克_GL8",
    "别克_Velite微蓝",
    "别克_昂科拉",
    "别克_昂科雷",
    "别克_昂科威",
    "别克_君威",
    "别克_君越",
    "别克_凯越",
    "别克_威朗",
    "别克_英朗",
    "别克_阅朗",
    "大通/迈克萨斯_D90",
    "大通/迈克萨斯_G10",
    "大通/迈克萨斯_G20",
    "大通/迈克萨斯_G50",
    "大众_CC",
    "大众_Polo",
    "大众_T-Cross途铠",
    "大众_宝来",
    "大众_高尔夫",
    "大众_高尔夫嘉旅",
    "大众_辉昂",
    "大众_甲壳虫",
    "大众_捷达",
    "大众_朗逸/朗逸Plus",
    "大众_凌渡",
    "大众_迈腾",
    "大众_帕萨特",
    "大众_桑塔纳",
    "大众_速腾",
    "大众_探歌",
    "大众_探岳",
    "大众_途安L",
    "大众_途昂",
    "大众_途观/途观L",
    "大众_途岳",
    "大众_蔚揽",
    "大众_蔚领",
    "大众_夏朗",
    "谛艾仕_DS 4S",
    "谛艾仕_DS 5",
    "谛艾仕_DS 5LS",
    "谛艾仕_DS 6",
    "谛艾仕_DS 7",
    "东风_风光330",
    "东风_风光330S",
    "东风_风光580",
    "东风_风行",
    "东风_风神A9",
    "东风_风神AX3",
    "东风_风神AX7",
    "东风_景逸S50",
    "东风_景逸X5",
    "东风_菱智",
    "东风_帅客",
    "东风_小康C37",
    "东南_A5翼舞",
    "东南_DX3",
    "丰田_C-HR",
    "丰田_RAV4",
    "丰田_汉兰达",
    "丰田_皇冠",
    "丰田_卡罗拉",
    "丰田_凯美瑞",
    "丰田_雷凌",
    "丰田_威驰",
    "丰田_威驰FS",
    "丰田_亚洲龙",
    "丰田_奕泽",
    "丰田_致享",
    "丰田_致炫",
    "福特_福克斯",
    "福特_福克斯Active",
    "福特_福睿斯",
    "福特_撼路者",
    "福特_金牛座",
    "福特_领界",
    "福特_蒙迪欧",
    "福特_锐界",
    "福特_探险者",
    "福特_途睿欧",
    "福特_翼虎",
    "广汽传祺_GA6",
    "广汽传祺_GA8",
    "广汽传祺_GM6",
    "广汽传祺_GM8",
    "广汽传祺_GS3",
    "广汽传祺_GS4",
    "广汽传祺_GS8",
    "哈弗_F5",
    "哈弗_F7",
    "哈弗_H2",
    "哈弗_H4",
    "哈弗_H6",
    "哈弗_H7",
    "哈弗_H9",
    "哈弗_M6",
    "海马_M3",
    "海马_V70",
    "汉腾_汉腾V7",
    "红旗_H5",
    "红旗_H7",
    "红旗_HS5",
    "红旗_HS7",
    "吉利_缤瑞",
    "吉利_缤越",
    "吉利_博瑞",
    "吉利_博瑞GE",
    "吉利_博越",
    "吉利_帝豪",
    "吉利_帝豪GL",
    "吉利_帝豪GS",
    "吉利_嘉际",
    "吉利_金刚",
    "吉利_星越",
    "吉利_远景S1",
    "吉利_远景SUV",
    "吉利_远景X1",
    "吉利_远景X3",
    "吉利_远景轿车",
    "江淮_瑞风",
    "江淮_瑞风M3",
    "江淮_瑞风S2",
    "江淮_瑞风S4",
    "捷豹_E-PACE",
    "捷豹_F-PACE",
    "捷豹_XEL",
    "捷豹_XFL",
    "捷豹_XJ",
    "金杯_750",
    "金杯_海狮",
    "金杯_小海狮X30L",
    "开瑞_K50",
    "凯迪拉克_ATS-L",
    "凯迪拉克_CT5",
    "凯迪拉克_CT6",
    "凯迪拉克_XT4",
    "凯迪拉克_XT5",
    "凯迪拉克_XT6",
    "凯迪拉克_XTS",
    "雷克萨斯_CT",
    "雷克萨斯_ES",
    "雷克萨斯_GS",
    "雷克萨斯_IS",
    "雷克萨斯_LS",
    "雷克萨斯_LX",
    "雷克萨斯_NX",
    "雷克萨斯_RC",
    "雷克萨斯_RX",
    "雷克萨斯_UX",
    "雷诺_科雷傲",
    "猎豹_CS9",
    "林肯_MKC",
    "林肯_MKX",
    "林肯_MKZ",
    "林肯_大陆",
    "林肯_飞行家",
    "林肯_航海家",
    "林肯_领航员",
    "领克_01",
    "领克_02",
    "领克_03",
    "陆风_X2",
    "路虎_发现",
    "路虎_发现神行",
    "路虎_揽胜",
    "路虎_揽胜极光",
    "路虎_揽胜星脉",
    "马自达_CX-4",
    "马自达_CX-5",
    "马自达_CX-8",
    "马自达_阿特兹",
    "马自达_昂克赛拉",
    "玛莎拉蒂_Ghibli",
    "玛莎拉蒂_Levante",
    "玛莎拉蒂_总裁",
    "名爵_HS",
    "名爵_MG 6",
    "名爵_ZS",
    "讴歌_CDX",
    "讴歌_MDX",
    "讴歌_RDX",
    "讴歌_TLX",
    "奇瑞_艾瑞泽5",
    "奇瑞_艾瑞泽GX",
    "奇瑞_捷途X70",
    "奇瑞_奇瑞E3",
    "奇瑞_瑞虎3",
    "奇瑞_瑞虎3x",
    "奇瑞_瑞虎5x",
    "奇瑞_瑞虎8",
    "启辰_D60",
    "启辰_M50V",
    "起亚_K3",
    "起亚_K5",
    "起亚_KX Cross",
    "起亚_KX5",
    "起亚_焕驰",
    "起亚_奕跑",
    "起亚_智跑",
    "日产_劲客",
    "日产_蓝鸟",
    "日产_骊威",
    "日产_楼兰",
    "日产_奇骏",
    "日产_骐达",
    "日产_天籁",
    "日产_途达",
    "日产_西玛",
    "日产_逍客",
    "日产_轩逸",
    "荣威_360",
    "荣威_950",
    "荣威_i5",
    "荣威_i6",
    "荣威_RX3",
    "荣威_RX5",
    "荣威_RX8",
    "三菱_欧蓝德",
    "三菱_帕杰罗",
    "三菱_奕歌",
    "斯巴鲁_XV",
    "斯巴鲁_傲虎",
    "斯巴鲁_力狮",
    "斯巴鲁_森林人",
    "斯柯达_柯迪亚克",
    "斯柯达_柯迪亚克GT",
    "斯柯达_柯珞克",
    "斯柯达_柯米克",
    "斯柯达_明锐",
    "斯柯达_明锐旅行版",
    "斯柯达_速派",
    "斯柯达_昕锐",
    "魏派_VV5",
    "魏派_VV6",
    "魏派_VV7",
    "沃尔沃_S60L",
    "沃尔沃_S90L",
    "沃尔沃_V40",
    "沃尔沃_V60",
    "沃尔沃_V90",
    "沃尔沃_XC40",
    "沃尔沃_XC60",
    "沃尔沃_XC90",
    "五菱_宏光",
    "五菱_宏光Plus",
    "五菱_宏光S3",
    "五菱_荣光",
    "五菱_之光",
    "现代_ix25",
    "现代_ix35",
    "现代_菲斯塔",
    "现代_领动",
    "现代_名图",
    "现代_瑞纳",
    "现代_胜达",
    "现代_索纳塔",
    "现代_途胜",
    "现代_悦动",
    "现代_悦纳",
    "新宝骏_RC-6",
    "新宝骏_RM-5",
    "新宝骏_RS-3",
    "新宝骏_RS-5",
    "雪佛兰_创界",
    "雪佛兰_创酷",
    "雪佛兰_科鲁泽",
    "雪佛兰_科沃兹",
    "雪佛兰_迈锐宝XL",
    "雪佛兰_探界者",
    "雪佛兰_沃兰多",
    "雪铁龙_C4毕加索",
    "雪铁龙_C5",
    "雪铁龙_C5天逸",
    "雪铁龙_C6",
    "雪铁龙_爱丽舍",
    "一汽奔腾_B30",
    "一汽奔腾_T77",
    "英菲尼迪_Q50L",
    "英菲尼迪_Q60",
    "英菲尼迪_Q70",
    "英菲尼迪_QX30",
    "英菲尼迪_QX50",
    "英菲尼迪_QX60",
    "英菲尼迪_QX80",
    "长安_CS15",
    "长安_CS35",
    "长安_CS55",
    "长安_CS75",
    "长安_CS85",
    "长安_CS95",
    "长安_CX70",
    "长安_奔奔",
    "长安_凌轩",
    "长安_欧诺",
    "长安_睿行S50",
    "长安_逸动",
    "长安_逸动DT",
    "长安_长安之星",
    "长安欧尚_A600",
    "长安欧尚_A800",
    "长安欧尚_X70A",
    "长安欧尚_科尚",
    "长安欧尚_长行",
    "众泰_T300",
    "特斯拉_Model 3",
    "特斯拉_Model S",
    "特斯拉_Model X"
  ]

  def check do
    Utils.read_csv_stream!("model-data.csv")
    |> Stream.drop(1)
    |> Stream.map(fn [_num | others] -> others end)
    |> Enum.to_list()
    |> List.flatten()
    |> Enum.reject(&(&1 == ""))
    |> Enum.map(fn model ->
      if Enum.find(@models, &(&1 == model)) do
        nil
      else
        model
      end
    end)
    |> Enum.reject(&is_nil(&1))
    |> Enum.uniq()
  end

  def start do
    stream = Utils.read_csv_stream!("model-data.csv")
    header = header(stream)

    body =
      stream
      |> Stream.drop(1)
      |> Flow.from_enumerable()
      |> Flow.map(&transform/1)
      |> Enum.to_list()

    %Workbook{sheets: [%Sheet{name: "Sheet1", rows: [header | body]}]}
    |> Utils.write_xlsx()
  end

  def header(stream) do
    [[_num | others]] =
      stream
      |> Stream.take(1)
      |> Enum.to_list()

    others =
      for target <- others, model <- @models do
        target <> "-" <> model
      end

    ["number" | others]
  end

  def transform([num | others]) do
    IO.puts(num)

    data =
      Enum.map(others, fn
        "" ->
          Enum.map(@models, fn _ -> nil end)

        target ->
          Enum.map(@models, fn model ->
            if target == model, do: 1, else: nil
          end)
      end)
      |> List.flatten()

    [num | data]
  end
end
